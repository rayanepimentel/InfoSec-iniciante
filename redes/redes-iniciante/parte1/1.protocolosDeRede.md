# Parte I

1. [Protocolos de rede](#1-protocolos-de-rede)
2. [Modelo OSI e TCP/IP](./2.modelosOSI.md)

## 1. Protocolos de rede

<pre>
Protocolos de Rede (TCP, UDP, RTP, DCCP, SCTP, SSH, NNTP etc);
</pre>

- [O que s√£o procotocolos de rede e para que servem?](#o-que-s√£o-procotocolos-de-rede-e-para-que-servem)
- [Tipos de protocolos de rede](#tipos-de-protocolos-de-rede)
- [1. IP](#1-ip)
- [2. TCP e UDP](#2-tcp-e-udp)
- [3. IPSec](#3-ipsec)
- [4. ICMP](#4-icmp)

### O que s√£o procotocolos de rede e para que servem?

Protocolos de rede s√£o os conjuntos de normas que permitem que duas ou mais m√°quinas conectadas √† internet se comuniquem entre si. Funciona como uma linguagem universal, que pode ser interpretada por computadores de qualquer fabricante, por meio de qualquer sistema operacional.

Eles s√£o respons√°veis por pegar os dados transmitidos pela rede e dividi-los em pequenos peda√ßos, que s√£o chamados de pacotes. Cada pacote carrega em si informa√ß√µes de endere√ßamento de origem e destino. Os protocolos tamb√©m s√£o respons√°veis pela sistematiza√ß√£o das fases de estabelecimento, controle, tr√°fego e encerramento.

Existem tr√™s elementos-chave que definem os protocolos de rede. S√£o eles:

    sintaxe: representa o formato dos dados e a ordem pela qual eles s√£o apresentados;
    sem√¢ntica: refere-se ao significado de cada conjunto sint√°tico que d√° sentido √† mensagem enviada;
    timing: define uma velocidade aceit√°vel de transmiss√£o dos pacotes.

Fonte/Cita√ß√£o: [opservices](https://www.opservices.com.br/protocolos-de-rede/)

### Tipos de protocolos de rede

Os tipos de protocolos de rede s√£o divididos de acordo com a sua natureza do servi√ßo disponibilizado. E tamb√©m em qual camada de profundidade est√£o localizados na rede de internet.

Essas camadas, junto com alguns exemplos de protocolos, s√£o:

- **Camada de Aplica√ß√£o**: Usada pelos programas para enviar e receber dados de outros programas pela pr√≥pria internet.
  - WWW (navega√ß√£o web), HTTP, SMPT (emails), FTP (transfer√™ncia de arquivos) e SSH.¬†
- **Camada de Transporte**: Para transporte de arquivos recebidos da camada anterior. Aqui acontece a organiza√ß√£o e a transforma√ß√£o deles em pacotes menores, que ser√£o enviados √† rede.
  - TCP, UDP e SCTP.
- **Camada de Rede**: Os arquivos empacotados na camada anterior s√£o recebidos e anexados ao IP da m√°quina que envia e que recebe os dados. Daqui, s√£o enviados pela internet usando a pr√≥xima camada.
  - IP (IPv4 e IPv6).
- **Camada de Estrutura F√≠sica**: √â a camada que executa o recebimento ou envio de arquivos na web.
  - Ethernet e Modem.

Fonte/Cita√ß√£o: [weblink](https://www.weblink.com.br/blog/tecnologia/conheca-os-principais-protocolos-de-internet/)

### 1. IP

O protocolo IP, do termo em ingl√™s Internet Protocol (Protocolo de Internet) faz parte da camada de internet e √© um dos protocolos mais importantes da web. Ele permite a elabora√ß√£o e transporte dos pacotes de dados, por√©m sem assegurar a sua entrega.

O destinat√°rio da mensagem √© determinado por meio dos campos de endere√ßo **IP** (endere√ßo do computador), **m√°scara de sub rede** (determina parte do endere√ßo que se refere √† rede) e o campo **gateway** estreita por padr√£o (permite saber qual o computador de destino, caso n√£o esteja localizado na rede local).

#### 1.1 IP, m√°scara de sub rede e gateway

O endere√ßo de IP, parece como o endere√ßo da nossa casa.
Para recebemos coisas/pacotes dos correrios, precisamos informar o endere√ßo da nossa casa.

E o IP precisa identificar o dispositivo para enviar e mandar coisas/pacotes.
Justamente pq o IP √© um procolo usado para identificar dispositivos e conex√µes.

Descobrindo endere√ßo de IP

```bash
#para linux:
$ ifconfig 
# ipconfig para windows
```

Como voc√™ j√° deve saber, o **IP √© o endere√ßo do dispositivo na web**. Explicando-o didaticamente, trata-se de uma sequ√™ncia num√©rica que rotula o computador, permitindo a sua identifica√ß√£o quando est√° online.

J√° a **m√°scara de rede** √© utilizada para definir a quantidade de endere√ßos IP pertencentes √† rede, concedendo um IP √∫nico a cada dispositivo integrado a ela, dividindo-os em sub-redes.

E o gateway √© o roteador/model/wifi. A sa√≠da p internet.

Gateway, vem do ingl√™s e significa ‚Äúport√£o de entrada‚Äù. Uma defini√ß√£o que deixa muito claro o seu prop√≥sito: servir como um elo entre dois pontos. Sendo assim, √© poss√≠vel notar que usamos o gateway o tempo todo quando nos conectamos √† internet.

Pense nisso: em sua casa, para se conectar √† rede, voc√™ precisa de um dispositivo como um smartphone ou um notebook. Por√©m, n√£o basta apenas ligar o aparelho, voc√™ precisa conect√°-lo a um roteador Wi-Fi, via cabo ou pelas redes m√≥veis, pois s√≥ assim poder√° come√ßar a navegar e adquirir informa√ß√µes.

Essas tr√™s op√ß√µes(wifi, cabo e rede m√≥veis) funcionam como o port√£o principal que vai permitir que todos os dados (de ambos os lados) atravessem para alcan√ßar seus destinos.

Fonte/Cita√ß√£o: [e-tinet](https://e-tinet.com/linux/ifconfig/) e [tecnoblog](https://tecnoblog.net/responde/o-que-e-gateway/)

#### 1.2 IP interno e IP externo

O IP local (ou IP interno) identifica cada dispositivo individualmente. Ou seja, √© o endere√ßo atribu√≠do pelo roteador √† sua m√°quina na rede local.

J√° o IP externo √© a identifica√ß√£o que o seu provedor de internet forneceu para sua resid√™ncia ou empresa. √â pelo IP externo que o seu dispositivo consegue se conectar √† rede mundial.

A principal diferen√ßa entre endere√ßos IP externos e internos √© o alcance e a que est√£o conectados. Um endere√ßo IP externo te identifica na Internet, para que todas as informa√ß√µes que procura possam chegar a voc√™. Um endere√ßo IP interno √© usado em uma rede privada para se conectar com seguran√ßa a outros dispositivos nessa mesma rede.

Fonte/Cita√ß√£o: [avast](https://www.avast.com/pt-br/c-ip-address-public-vs-private)

**Exemplo**:

![IP interno e Externo](/redes//redes-iniciante/pics/ipInternoExterno.png)

> Estou no meu notebook e quero me comunicar com o site www.google.com ‚Üí O IP interno 192.168.0.109 do meu dispositivo envia a informa√ß√£o para o IP interno do roteador (gateway  192.168.0.1) ‚Üí e o IP interno 192.168.0.1 envia para rede externa 216.58.192.5 ‚Üí que faz a comunica√ß√£o com a internet.

#### O que podemos descobrir com o IP?

- O sistema do roteador
- Quais portas est√£o abertas (port scan - NMAP)
- Servidor exposto

Mas voc√™ pode reiniciar o roteador/modem ou entrar em contato com o provedor de internet para mudar o IP.

#### 1.3 IPv4 e IPv6

J√° pensou no caos que seria o servi√ßo de correios se houvesse um limite para designar endere√ßos no mundo? Novas casas come√ßam a surgir, mas n√£o temos como identific√°-las, porque as op√ß√µes de endere√ßos acabaram! Foi mais ou menos isso que aconteceu com os endere√ßos das m√°quinas que acessam a internet.

O que acontece √© que o Protocolo de Internet definido na d√©cada de 80, l√° no in√≠cio da internet, tamb√©m conhecido como IPv4, tem um limite de combina√ß√µes de endere√ßos de 4 bilh√µes. Claro que na √©poca em que foi criado n√£o se imaginaria que algum dia essa quantidade seria insuficiente para atender a todos, mas √† medida que a internet foi se popularizando e outros dispositivos como os smartphones come√ßaram a surgir, foi preciso pensar em algumas solu√ß√µes para o problema do esgotamento de endere√ßos IP.

**O que √© IPv4 e IPv6?**

- **IPv4** (Internet Protocol vers√£o 4) √© o formato de endere√ßo padr√£o que permite que todos os computadores na internet se comuniquem entre si. O IPv4 √© escrito como uma sequ√™ncia de d√≠gitos de 32 bits e um endere√ßo IPv4 √© composto por quatro n√∫meros, cada um entre 0 e 255, separados por pontos.

O IPv4 permite mais de 4 bilh√µes de endere√ßos diferentes e tem nos atendido bem por d√©cadas.

> exemplo de IPv4: 168.213.226.204

- **IPv6** (Internet Protocol vers√£o 6) √© um padr√£o atualizado para identificar computadores na Internet. Como o IPv4, ele oferece um identificador exclusivo a cada dispositivo, que foi ajustado para acomodar o n√∫mero crescente de computadores conectados √† internet.

O IPv6 aumenta o n√∫mero de endere√ßos IP poss√≠veis de 4 bilh√µes de IPv4 para 340 trilh√µes de trilh√µes de trilh√µes. O IPv6 √© escrito como uma string hexadecimal de d√≠gitos de 128 bits e um endere√ßo IPv6 t√≠pico se parece com isto:

> 2001:0ab8:85a2:0000:0000:8a3e:0370:7334

**As principais diferen√ßas entre o protocolo IPv4 e IPv6**

- A principal diferen√ßa entre o protocolo IPv4 e o protocolo IPv6 √© a capacidade de expans√£o que cada um apresenta. Como vimos anteriormente, o IPv6 possibilita a cria√ß√£o de muito mais endere√ßos do que seu antecessor; cerca de 79 octilh√µes a mais, para ser mais espec√≠fico. O que √© o mesmo que 56 octilh√µes de endere√ßos por ser humano na terra.

- O IPv6 tamb√©m acabou com um dos maiores vil√µes do IPv4: o broadcast. Na nova vers√£o, s√£o utilizados apenas unicast e multicast, e houve a introdu√ß√£o do anycast, um tipo de endere√ßo configurado em m√∫ltiplas interfaces.

```bash
- Unicast: Comunica√ß√£o um para um.
- Multicast: Comunica√ß√£o um para muitos (grupo de dispositivos configurados com o mesmo endere√ßo).
- Anycast: Endere√ßo configurado em m√∫ltiplas interfaces.
```

- Al√©m disso, no protocolo IPv6 n√£o se usa mais o termo ‚Äúm√°scara‚Äù, e sim ‚Äúprefixo‚Äù, mudando a forma de endere√ßamento. Ele ainda mant√©m a parte de rede, sub rede e host, como no protocolo IPv4, mas h√° essa diferen√ßa.

- Por fim, o IPv6 tamb√©m difere do seu precursor na parte do cabe√ßalho ou header. Nele, tudo foi simplificado e houve a introdu√ß√£o dos chamados ‚Äúcabe√ßalhos de extens√£o‚Äù, al√©m do suporte nativo a quest√µes importantes como seguran√ßa e QoS. Assim, podemos concluir que o protocolo IPv6 √© uma vers√£o muito mais eficiente, segura e √∫til que o IPv4.

|         | IPv4   |  IPv6  |
----------|--------|---------|
| Tamanho do endere√ßo | 32-bits(0-255)   | 128-bits(16 octetos) |
| Nota√ß√£o | Decimal com ponto | Hexadecimal alfan√∫merica |
| Exemplo | 168.213.226.204 | 2001:0ab8:85a2:0000:0000:8a3e:0370:7334 |
| Como obter o IP | DHCP ou configura√ß√£o manual | Compat√≠vel com configura√ß√£o autom√°tica |

**Seguran√ßa**

- Ipv6 criptografia de ponta a ponta, tornando o ataque man-in-the-middle(MITM) mais dif√≠cil.
- IPSec nativo(mas o usu√°rio precisa ativar). Existe no IPv4, mas precisa ser configurado pelo provedor de internet.
  - IPSec fornece recursos de criptografia de pacotes de dados, de forma a garantir tr√™s aspectos destes: integridade, confidencialidade e autenticidade.

**IPv6 √© mais/menos seguro que IPv4?**

Comparar a seguran√ßa do IPv4 com a seguran√ßa do IPv6 n√£o faz sentido. Ambos tem as suas vulnerabilidades.

√â essencial lembrar que muitos ataques acontecem acima da camada de rede(modelo TCP/IP). Um e- mail de phishing associado a ransomware, por exemplo, representa a mesma amea√ßa, seja entregue por um link IPv4 ou IPv6.

Ou seja, n√£o √© limita√ß√£o de tecnologia e sim grande parte dos ataques se reume ao fator humano.

A coisa mais importante que voc√™ pode fazer para aumentar a seguran√ßa IPv6 da sua organiza√ß√£o √© aprender o protocolo, como ele funciona e como ele √© implementado em diferentes sistemas.

Fontes: [avg](https://www.avg.com/pt/signal/ipv4-vs-ipv6), [hostone](https://blog.hostone.com.br/protocolo-ipv4-ipv6/), [eletronet](https://www.eletronet.com/blog/entenda-as-diferencas-entre-ipv4-e-ipv6/) e [dltec](http://www.dltec.com.br/blog/redes/diferencas-entre-ipv4-e-ipv6/)

### 2. TCP e UDP

TCP e UDP s√£o protocolos que determinam como os dados s√£o trocados pela Internet. Ambos constru√≠dos sobre o protocolo IP, eles compartilham muitas semelhan√ßas, mas a diferen√ßa entre TCP e UDP os tornam adequados para finalidades diferentes. Eles s√£o os dois protocolos mais amplamente usados com os quais os usu√°rios da Internet e empresas interagem diariamente.

#### **TCP**

O protocolo de controle de transmiss√£o (TCP) √© orientado √† conex√£o, o que significa que, uma vez que a conex√£o foi estabelecida, os dados podem ser transmitidos em duas dire√ß√µes. Ele tem sistemas integrados para verificar se h√° erros e garantir que os dados sejam entregues na ordem em que foram enviados, tornando-o o protocolo perfeito para a transfer√™ncia de informa√ß√µes como imagens est√°ticas, arquivos de dados e p√°ginas da web.

**Como funciona?**

Quando voc√™ solicita uma p√°gina da web em seu navegador, seu computador envia pacotes TCP para o endere√ßo do servidor da web, solicitando que ele envie a p√°gina da web de volta para voc√™. O servidor da web responde enviando um fluxo de pacotes TCP, que o seu navegador da web une para formar a p√°gina da web. Quando voc√™ clica em um link, entra, posta um coment√°rio ou faz qualquer outra coisa, seu navegador da web envia pacotes TCP para o servidor e o servidor envia pacotes TCP de volta.

O TCP tem tudo a ver com confiabilidade ‚Äî os pacotes enviados com TCP s√£o rastreados para que nenhum dado seja perdido ou corrompido em tr√¢nsito. √â por isso que os downloads de arquivos n√£o s√£o corrompidos, mesmo se houver problemas na rede. Claro, se o destinat√°rio estiver offline, seu computador desistir√° e voc√™ ver√° uma mensagem de erro dizendo que ele n√£o pode se comunicar com o host remoto.

![tcp](../pics/tcp.png)

Handshake TCP de 3 tempos:

Handshal permite a uatentica√ß√£o e o encerramento de uma conex√£o completa:

1. O  **cliente** **enviar√°** ao **servidor** uma solicita√ß√£o "**SYN**", "pedindo" o estabelecimento de uma conex√£o.
2. Uma vez que o **servidor** tenha **processado** a resposta, uma resposta "**SYN-ACK**" ser√° **enviada** de **volta** ao **cliente**, reconhecendo que foi recebida.
3. O **cliente responde** com um "**ACK**" e, uma vez recebido pelo servidor, a comunica√ß√£o √© estabelecida.

#### UDP

O User Datagram Protocol (UDP) √© um protocolo de Internet mais simples e sem conex√£o, no qual os servi√ßos de verifica√ß√£o e recupera√ß√£o de erros n√£o s√£o necess√°rios. Com o UDP, n√£o h√° sobrecarga para abrir, manter ou encerrar uma conex√£o ‚Äî os dados s√£o continuamente enviados para o destinat√°rio, quer ele os receba ou n√£o.

No UPD temos:

- **Porta de origem**: Neste campo √© armazenado qual a porta de origem do pacote o que permite receber uma resposta, como uma consulta DNS. Este campo possui 16 bits de tamanho.
- **Porta de destino**: Neste campo fica armazenado qual a porta o pacote ser√° enviado assim que for entregue √† m√°quina especifica. Quando for entregue, ele ser√° tratado pela aplica√ß√£o que estar√° funcionando na mesma. Este campo possui um tamanho de 16 bits.
- **Comprimento da mensagem**: Este √© um campo que especifica o comprimento em bytes do cabe√ßalho UDP mais os dados carregados. O tamanho m√≠nimo √© de 8 bytes devido ao comprimento do cabe√ßalho. O tamanho m√°ximo poss√≠vel para um datagrama UDP √© de 65.507 bytes (65.535 ‚àí 8 bytes do cabe√ßalho UDP ‚àí 20 bytes do cabe√ßalho IP), devido ao protocolo IPv4. Em IPv6 √© poss√≠vel termos pacotes de tamanho maior do que 65.535.
- **Checksum**: Pode ser usado para verifica√ß√£o de erros do cabe√ßalho e dos dados transmitidos. √â opcional em IPv4 e mandat√≥rio em IPv6. Se n√£o for usado, dever√° ser preenchido com zeros.

>UDP simplesmente envia os pacotes. N√£o quer saber se foi recebido ou n√£o.

**Como funciona?**

O protocolo UDP funciona de forma semelhante ao TCP, mas elimina todo o material de verifica√ß√£o de erros. Toda a comunica√ß√£o de ida e volta introduz lat√™ncia, tornando as coisas mais lentas.

Quando um aplicativo usa UDP, os pacotes s√£o enviados apenas para o destinat√°rio. O remetente n√£o espera para ter certeza de que o destinat√°rio recebeu o pacote. Se o destinat√°rio perder alguns pacotes UDP aqui e ali, o remetente n√£o os reenviar√°. Perder toda essa sobrecarga significa que os dispositivos podem se comunicar mais rapidamente.

UDP √© usado quando a velocidade √© desej√°vel e a corre√ß√£o de erros n√£o √© necess√°ria. Por exemplo, ele √© frequentemente usado para transmiss√µes ao vivo e jogos online. Digamos que voc√™ esteja assistindo a um stream de v√≠deo ao vivo, que geralmente √© transmitido usando UDP em vez de TCP. O servidor apenas envia um fluxo constante de pacotes UDP para os computadores que est√£o assistindo.

Se voc√™ perder a conex√£o por alguns segundos, o v√≠deo pode congelar ou ficar tr√™mulo por um momento e, em seguida, pular para o trecho atual da transmiss√£o. Se ocorrer uma pequena perda de pacote, o v√≠deo ou √°udio pode ficar distorcido por um momento, pois o v√≠deo continua a ser reproduzido sem os dados ausentes.

![udp](../pics/udp.png)

#### Quando usar TCP ou UDP?

Os servi√ßos que exigem que um cliente e um servidor enviem pacotes simultaneamente funcionam melhor com o TCP, pois ajuda a ativar a largura de banda total da rede. Use o TCP quando um pequeno atraso estiver bom e voc√™ precisar se concentrar na confiabilidade em vez da velocidade. Exemplos de aplicativos que usam TCP s√£o o Instagram e a maioria dos servi√ßos de e-mail . Servi√ßos de v√≠deo como Netflix e YouTube tamb√©m o utilizam para manter a integridade dos dados.

O UDP √© melhor quando o cliente e o servidor enviam pacotes independentemente e os aplicativos s√£o sens√≠veis ao tempo. Como n√£o h√° atrasos de retransmiss√£o, funciona bem para (a maioria) jogos de RPG, bem como para servi√ßos de DNS e VOIP como o Zoom, que exigem velocidades r√°pidas.

Alguns servi√ßos combinam os dois protocolos para uma solu√ß√£o r√°pida e confi√°vel. Por exemplo, o Skype usa TCP para sinaliza√ß√£o e UDP/TCP para transporte de tr√°fego.

#### Resumo

| | |
---|---|
|TCP |TCP √© um protocolo orientado √† conex√£o e fornece a comunica√ß√£o confi√°vel com v√°rios recursos.|
|UDP |UDP √© um protocolo de transporte em tempo real sem conex√£o, que oferece um processo de comunica√ß√£o mais r√°pido, mas com pouca confiabilidade|

| | TCP| UDP|
--|--|--|
|Conex√£o | Orientado √† conex√£o ‚Äî O dispositivo deve estabelecer uma conex√£o antes de transmitir dados e fechar a conex√£o ap√≥s a transmiss√£o(conecta - verifica se o destino t√° online - envia os pacotes - termina de enviar os pacotes - finaliza a conex√£o).| Sem conex√£o(normalmente usado em transmiss√µes de Broadcast)
|Confiabilidade |Confi√°vel ‚Äî A entrega do pacote de dados √© garantida. TCP pode recuperar pacotes perdidos, eliminar pacotes duplicados, recuperar dados corrompidos e recuperar a liga√ß√£o em caso de problemas no sistema e na rede| N√£o confi√°vel, as mensagens enviadas podem n√£o alcan√ßar o destino.|
|Transmiss√£o | Full duplex, √© poss√≠vel a transfer√™ncia simult√¢nea em ambas dire√ß√µes(cliente-servidor) durante toda a sess√£o, toda comunica√ß√£o.|  broadcast e multicast|
|Tipo de informa√ß√£o de comunica√ß√£o| Stateful ‚Äî O cliente e o servidor mantem as informa√ß√µes sobre a sess√£o.| Stateless ‚Äî O servidor n√£o mant√©m nenhuma informa√ß√£o sobre a sess√£o. |
|Sequ√™ncia | Todos os pacotes s√£o encaminhados ao destinat√°rio de forma ordenada, mas n√£o significa que ir√° chegar de forma ordenada, por conta das rotas, latencia... O ponto final, precisa organizar todos esses pacotes.| N√£o h√° ordena√ß√£o dos segmentos, se chegarem fora de ordem, n√£o ser√£o reordenados.|
|Fluxo| O receptor, a medida que recebe os dados, envia mensagens ACK, confima a recep√ß√£o de um segmento, dado, como funcionalidade extra.| N√£o h√° confirma√ß√£o de recpe√ß√£o dos segmentos|
|Velocidade|O TCP √© mais lento que o UDP porque realiza verifica√ß√£o de erros, gerenciamento de fluxo e garante a entrega de pacotes de dados.| O UDP √© mais r√°pido que o TCP, pois n√£o garante a entrega do pacote de dados.|
|Aplica√ß√£o | Navega√ß√£o na web. Transfer√™ncia de arquivo. E-mail (SMTP, IMAP/POP)| VPN. Streaming de v√≠deo e m√∫sica. Jogos online, jogos multiplayer. Transmiss√µes ao vivo e videoconfer√™ncia. Consultas de sistema de nome de dom√≠nio (DNS). Voz sobre IP (VoIP).|

Fonte: [gaea](https://gaea.com.br/diferenca-entre-tcp-e-udp/) e [privateinternetaccess](https://www.privateinternetaccess.com/blog/tcp-vs-udp-understanding-the-difference/)

### 3. IPSec

IP Security Protocol

O IPSec √© um protocolo de camada 3(camada de rede) projetado para suprir a falta de seguran√ßa de informa√ß√µes trafegando em rede p√∫blica. Basicamente o IPSec protege os pacotes IP de dados privados, encapsulando em outros pacotes IP para serem transportados. H√° duas maneiras do IPSec ser implementado: modo t√∫nel e modo transporte, sendo este √∫ltimo o modo nativo.

A diferen√ßa entre os modos est√° no encapsulamento. O modo transporte encapsula somente os dados, enquanto o modo t√∫nel encapsula os dados e o cabe√ßalho. Sendo assim, o modo transporte n√£o garante a confiabilidade dos dados durante o envio. Por isso √© utilizado em dispositivos que j√° possuem o protocolo IPSec incorporados em sua pilha TCP/IP.

O IPSec fornece os seguintes servi√ßos de seguran√ßa: autentica√ß√£o, controle de acesso(AAA), confidencialidade e integridade dos dados. Os habilitadores das tecnologias de seguran√ßa utilizados pelo IPSec s√£o: CHAP(Challenge Handshake Authentication Protocol), RADIUS(Remote Authentication Dial-in User Service) e a Encripta√ß√£o de Dados e dos Certificados Digitais.

**Por que o IPSec √© importante?**

A Internet Engineering Task Force desenvolveu o IPSec na d√©cada de 1990 para garantir a confidencialidade, integridade e autenticidade dos dados ao acessar redes p√∫blicas. Por exemplo, os usu√°rios se conectam √† Internet utilizando uma rede privada virtual (VPN) IPSec para acessar os arquivos da empresa remotamente. O protocolo IPSec criptografa informa√ß√µes confidenciais para evitar monitoramento indesejado. O servidor tamb√©m pode verificar se os pacotes de dados recebidos est√£o autorizados.

**Quais s√£o os usos do IPSec?**

O IPsec pode ser usado para o seguinte:

- Fornecer seguran√ßa ao roteador quando ocorrer envio de dados pela Internet p√∫blica.
- Criptografar os dados da aplica√ß√£o.
- Autenticar dados rapidamente, caso os dados se originem de um remetente conhecido.
- Proteger os dados da rede configurando circuitos criptografados, chamados de t√∫neis IPsec, que criptografam todos os dados enviados entre dois endpoints.

As organiza√ß√µes usam o IPSec para se proteger contra ataques de reprodu√ß√£o. O ataque de reprodu√ß√£o, ou ‚Äúataque man-in-the-middle‚Äù, corresponde ao ato de interceptar e alterar uma transmiss√£o em andamento, roteando dados para um computador intermedi√°rio. O protocolo IPSec atribui um n√∫mero sequencial a cada pacote de dados e realiza verifica√ß√µes para detectar sinais de pacotes duplicados.

Fonte: [ufrj](https://www.gta.ufrj.br/ensino/eel878/redes1-2016-1/16_1_2/vpn/vpn_ipsec2/vpn_ipsec/ipsec.html) e [aws](https://aws.amazon.com/pt/what-is/ipsec/)

### 4. ICMP

ICMP ( Internet Control Message Protocol ) √© um protocolo que os dispositivos de rede (por exemplo, roteadores) usam para gerar mensagens de erro quando problemas de rede impedem a passagem de pacotes IP.

> ICMP pode ser usado para relatar e debugar esses erros.

O protocolo ICMP notifica o remetente se os dados n√£o forem recebidos pelo destinat√°rio ou recebidos na ordem errada. Assim, o ICMP √© um protocolo para comunicar informa√ß√µes sobre dados, mas n√£o gerencia os dados em si.

Por exemplo, um remetente pode querer enviar uma mensagem para um determinado destino, mas o roteador n√£o pode faz√™-lo. Nesse caso, o roteador informa ao remetente que a mensagem n√£o pode ser entregue a esse destino.

#### Objetivo

Embora a camada de Rede(modelo OSI) n√£o deva se preocupar com a garantia de conex√£o, o ICMP fornece feedback sobre as comunica√ß√µes quando as coisas d√£o errado . Portanto, mesmo se voc√™ usar o [UDP](#udp), que possui um modelo de comunica√ß√£o sem conex√£o , ainda √© poss√≠vel descobrir por que uma transmiss√£o falhou. Todos os dispositivos conectados √† rede podem processar mensagens ICMP, incluindo roteadores e dispositivos terminais. O ICMP foi adaptado para funcionar com o IPv6 t√£o bem quanto ao IPv4.

Mas vale lembrar que o ICMP n√£o tem a necessidade de obter recursos da camanda de transporte ( TCP ou UDP ), portanto ele √© considerado como **‚Äùconnectionless‚Äù** fazendo com que n√£o h√° necessidade de abrir conex√£o para enviar a mensagem.

#### Mensagens

As mensagens ICMP s√£o transmitidas em datagramas IP e divididas em duas categorias:

- Mensagem de Error-reporting ou mensagem de erro
- Mensagem de consulta/informa√ß√£o

1. **Mensagem de erro**:
A mensagem de relat√≥rio de erro indica que, quando o roteador encontrar um problema durante o processamento de um pacote IP, ele enviar√° uma mensagem. Usadas para informar a um dispositivo transmissor que um erro ocorreu durante a transmiss√£o do datagrama. Geralmente os erros s√£o relacionados √† estrutura do datagrama em si, ou problemas encontrados durante o tr√°fego dos pacotes atrav√©s da rede.

2. **Mensagem de consulta**:
S√£o mensagens que permitem aos dispositivos trocarem informa√ß√µes entre si e realizarem determinados tipos de testes e diagn√≥sticos. As mensagens de consulta s√£o aquelas que ajudam o host a obter informa√ß√µes espec√≠ficas de outro host. Digamos que haja um cliente e um servidor e o cliente queira saber se o servidor est√° funcionando. Ele envia uma mensagem ICMP ao servidor para descobrir.

**Formato da mensagem ICMP**

![msn icmp](../pics/icmp-message-format.webp)

| | |
--|--|
|Type| Especifica o tipo de mensagem ICMP|
|Code| Especifica o subtipo da mensagem ICMP|
|Checksum| Determina se a mensagem cont√©m ou n√£o um erro|
|Data| No contexto das mensagens de erro, o pacote cont√©m as informa√ß√µes completas do pacote nesta se√ß√£o.|

##### Tipos de mensagens

Como vimos as mensagens ICMP s√£o geralmente divididas em duas categorias:

| |  |  | | |
--|--|--|--| --|
|Categoria| Tipo | Mensagem| Descri√ß√£o| Code |
|Mensagem de erro | 3| Destino Inacess√≠vel| Quando um pacote falha em alcan√ßar seu destino pretendido| 0 - 15|
|Mensagem de erro | 4 | Source Quench|  Para cada datagrama descartado devido ao congestionamento da camada de rede, o roteador envia uma mensagem source-quench.| 0|
|Mensagem de erro | 11 | Tempo excedido| Quando um pacote √© enviado de uma camada com 1500 unidades para uma camada com 300 unidades, o pacote √© fragmentado; esse processo √© conhecido como fragmenta√ß√£o. Essas 1.500 unidades s√£o divididas em cinco fragmentos, f1, f2, f3, f4 e f5, que chegam ao destino em ordem. Ser√° descartado todos os fragmentos recebidos e enviado uma mensagem de tempo excedido para a fonte original se todos os fragmentos n√£o chegarem ao destino dentro de um determinado per√≠odo de tempo.| 0 ou 1|
|Mensagem de erro | 12 | Problemas de Par√¢metros | Uma mensagem de problema de par√¢metro pode ser enviada pelo roteador e pelo host de destino. Esta mensagem indica que alguns par√¢metros foram configurados incorretamente.| 0 ou 1|
|Mensagem de consulta | 8 ou 0 | echo-request(8) ou replay(0) |Uma mensagem echo-request pode ser enviada por um roteador ou host. √â usado para enviar uma mensagem "Voc√™ est√° vivo?" para outro host. Se o outro host ainda estiver ativo, a mensagem de echo-replay ser√° enviada. O roteador ou o host que recebe uma mensagem de echo-request envia uma mensagem de echo-replay. | 0|
|Mensagem de consulta |13 ou 14 | Timestamp request(13) or replay(14) |Pode ser usado para calcular o tempo de ida e volta entre a origem e o destino, mesmo que os rel√≥gios n√£o estejam sincronizados.|0|

> echo/eco √© a mesma coisa que PING

#### Ataques ICMP

<pre>
üí°
Os agentes de amea√ßas usam pacotes de eco (pings) do protocolo de mensagens de controle da Internet (ICMP) para</br>descobrir sub-redes e hosts em uma redeprotegida, para gerar ataques de inunda√ß√£o DoS e para alterar </br>as tabelas de roteamento de host.
    
</pre>

Os atores da amea√ßa usam o ICMP para reconhecimento e ataques de varredura. Eles podem lan√ßar ataques de coleta de informa√ß√µes para mapear uma topologia de rede, descobrir quais hosts est√£o ativos (acess√≠veis), identificar o sistema operacional do host (impress√£o digital do sistema operacional) e determinar o estado de um firewall. Os agentes de amea√ßas tamb√©m usam ICMP para ataques DoS.

Os analistas de seguran√ßa devem ser capazes de detectar ataques relacionados ao ICMP observando o tr√°fego capturado e os arquivos de log. No caso de grandes redes, dispositivos de seguran√ßa como firewalls e sistemas de detec√ß√£o de intrus√£o (IDS) detectam tais ataques e geram alertas para os analistas de seguran√ßa.

| | |
--|--|
Mensagens ICMP usadas por hackers|Descri√ß√£o
Solicita√ß√£o de eco ICMP e resposta de eco| Isso √© usado para realizar verifica√ß√£o de host e ataques DoS.
ICMP inacess√≠vel| Isso √© usado para realizar o reconhecimento de rede e ataques de varredura.
Resposta de m√°scara ICMP| Isso √© usado para mapear uma rede IP interna.
Redirecionamentos ICMP| Isso √© usado para atrair um host alvo para enviar todo o tr√°fego atrav√©s de um dispositivo comprometido e criar um ataque MITM.
Descoberta de roteador ICMP| Isso √© usado para injetar entradas de rota falsas na tabela de roteamento de um host de destino.

> Solicita√ß√µes de eco e resposta de eco = echo-request e echo-replay

**Ataque de inunda√ß√£o PING**
Uma inunda√ß√£o ping √© um ataque de nega√ß√£o de servi√ßo no qual o invasor tenta sobrecarregar um dispositivo visado com pacotes de solicita√ß√£o de eco ICMP, fazendo com que o alvo se torne inacess√≠vel para o tr√°fego normal. Quando o tr√°fego de ataque se origina em v√°rios dispositivos, o ataque torna-se um DDoS ou ataque Distribu√≠do de Nega√ß√£o de Servi√ßo.

A forma DDoS de uma inunda√ß√£o Ping (ICMP) pode ser dividida em duas etapas que se repetem:

1. O invasor envia muitos pacotes de solicita√ß√£o de eco ICMP para o servidor visado usando v√°rios dispositivos.
2. O servidor visado ent√£o envia um pacote de resposta de eco ICMP para cada endere√ßo de IP do dispositivo solicitante como resposta.

![ping icmp](../pics/ping-icmp-flood-ddos-attack-diagram.webp)

Mais ataques: [CNNA-Network](https://ccna.network/vulnerabilidades-ameacas-ip/), [UFRJ](https://www.gta.ufrj.br/grad/13_1/dos/ataques.html), [comparitech](https://www.comparitech.com/net-admin/what-is-icmp/), [infosecinstitute](https://resources.infosecinstitute.com/topic/icmp-attacks/)

#### Laborat√≥rio pr√°tico

- [sgoncalves - Nmap e Ping Sweep](https://sgoncalves.tec.br/nmap-e-ping-sweep/)
- [Laborat√≥rio Wireshark ARP/ICMP](https://docplayer.com.br/20166738-Laboratorio-wireshark-arp-icmp-1.html)

Fonte: [bosontreinamentos](http://www.bosontreinamentos.com.br/redes-computadores/curso-de-redes-protocolo-icmp-internet-control-message-protocol/), [data-flair](https://data-flair.training/blogs/icmp-protocol/), [CNNA-Network](https://ccna.network/vulnerabilidades-ameacas-ip/) e [cloudflare](https://www.cloudflare.com/pt-br/learning/ddos/ping-icmp-flood-ddos-attack/)
